# close函数
```c
int close(int sockfd)
```
会对套接字引用计数减一，一旦发现套接字引用计数到 0，就会对套接字进行彻底释 放，并且会关闭 TCP 两个方向的数据流。

close 函数具体是如何关闭两个方向的数据流呢？ 
+ 在输入方向，系统内核会将该套接字设置为不可读，任何读操作都会返回异常。 
+ 在输出方向，系统内核尝试将发送缓冲区的数据发送给对端，并最后向对端发送一个 FIN 报 文，接下来如果再对该套接字进行写操作会返回异常。

# shutdown 函数
```
int shutdown(int sockfd, int howto)
```
对已连接的套接字执行 shutdown 操作，若成功则为 0，若出错则为 -1。
howto参数:
+ SHUT_RD：断开输人流。
+ SHUT_WR：断开输出流。
+ SHUT_RDWR：同时断开I/O流。

基于TCP的半关闭
# shutdown 和 close 的区别
1. close 会关闭连接，并释放所有连接对应的资源，而 shutdown 并不会释放掉套 接字和所有的资源。 
2. close 存在引用计数的概念，并不一定导致该套接字不可用；shutdown 则不管 引用计数，直接使得该套接字不可用，如果有别的进程企图使用该套接字，将会受到影响。 
3. close 的引用计数导致不一定会发出 FIN 结束报文，而 shutdown 则总是会发 出 FIN 结束报文，这在我们打算关闭连接通知对端的时候，是非常重要的。